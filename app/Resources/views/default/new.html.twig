{% extends '@STGTheme/Default/base.html.twig' %}
{#PRUEBA DEPENDENT SELECT #}
{% form_theme form _self %}

{% block _representante_representantes_entry_widget %}
    {{ dump() }}
    <div class="form-row">
        <div class="form-group col-md-6">
            {{ form_label(representante.dni) }}
            {#{{ form_widget(form.representantes.dni, {'attr': {'class': form_errors(form.representantes.dni) ? 'form-control is-invalid' : 'form-control'}}) }}
            <div class="invalid-feedback">
                {{ form_errors(form.representantes.dni) }}
            </div>#}
        </div>
    </div>   
{% endblock %}



{% block content %}

    
    <div class="card bg-light mb-12">
        


        <div class="card-body">
            <h1>Formulario A</h1>
            <h1>Datos Identificatorios:</h1>
                {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
           
                {#<div class="form-row">
                    <div class="form-group col-md-12">
                        {{ form_label(form.resumenEjecutivo) }}
                        {{ form_widget(form.resumenEjecutivo, {'attr': {'class': form_errors(form.resumenEjecutivo) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.resumenEjecutivo) }}
                        </div>
                    </div>#}
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.cuit) }}
                        {{ form_widget(form.cuit, {'attr': {'class': form_errors(form.cuit) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.cuit) }}
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        {{ form_label(form.razonSocial) }}
                        {{ form_widget(form.razonSocial, {'attr': {'class': form_errors(form.razonSocial) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.razonSocial) }}
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.tipoPersona) }}
                        {{ form_widget(form.tipoPersona, {'attr': {'class': form_errors(form.tipoPersona) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.tipoPersona) }}
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        {{ form_label(form.fechaInicioActividades) }}
                        {{ form_widget(form.fechaInicioActividades, {'attr': {'class': form_errors(form.fechaInicioActividades) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.fechaInicioActividades) }}
                        </div>
                    </div>
                </div>

                <h1>Domicilio Legal:</h1>
                        
                {#<div class="form-row">
                    <div class="form-group col-md-3">
                        {{ form_label(form.domicilio.calle) }}
                        {{ form_widget(form.domicilio.calle, {'attr': {'class': form_errors(form.domicilio.calle) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.calle) }}
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        {{ form_label(form.domicilio.numero) }}
                        {{ form_widget(form.domicilio.numero, {'attr': {'class': form_errors(form.domicilio.numero) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.numero) }}
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        {{ form_label(form.domicilio.piso) }}
                        {{ form_widget(form.domicilio.piso, {'attr': {'class': form_errors(form.domicilio.piso) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.piso) }}
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        {{ form_label(form.domicilio.depto) }}
                        {{ form_widget(form.domicilio.depto, {'attr': {'class': form_errors(form.domicilio.depto) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.depto) }}
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.domicilio.telefono) }}
                        {{ form_widget(form.domicilio.telefono, {'attr': {'class': form_errors(form.domicilio.telefono) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.telefono) }}
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        {{ form_label(form.domicilio.email) }}
                        {{ form_widget(form.domicilio.email, {'attr': {'class': form_errors(form.domicilio.email) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.email) }}
                        </div>
                    </div>
                </div>#}
                
                <h3>Perito, consultor o experto</h3>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.idperito) }}
                        {{ form_widget(form.idperito, {'attr': {'class': form_errors(form.idperito) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.idperito) }}
                        </div>
                    </div>
                    
                </div> 
                
                
{#                <div class="form-row">
                    <div class="form-group col-md-6">
                        {{ form_label(form.domicilio.zonificacion) }}
                        {{ form_widget(form.domicilio.zonificacion, {'attr': {'class': form_errors(form.domicilio.zonificacion) ? 'form-control is-invalid' : 'form-control'}}) }}
                        <div class="invalid-feedback">
                            {{ form_errors(form.domicilio.zonificacion) }}
                        </div>
                    </div>
                </div>#}
                
                <h3>Representantes</h3>
                
                <ul class="representantes" data-prototype="{{ form_widget(form.representantes.vars.prototype)|e('html_attr') }}">
                    {# iterate over each existing representante and render its only field: name #}
                    {% for representante in form.representantes %}
                        <li></li>
                    {% endfor %}
                </ul>
                
                <div class="form-row">
                    <div>
                        {#{{ form_widget(form.save) }}#}
                        <button type="submit" class="btn btn-primary" formnovalidate>Guardar</button>
                    </div>
                    <div>&nbsp;</div>{# Espacio en blanco p/separar botones #}
                    <div>
                        <button type="button" class="btn btn-primary" onclick="window.location.href = '{{ path('listar_formularios') }}'">Volver</button>
                    </div>
                </div>
                    
                
                {{form_end(form)}}
        </div>
    </div>
{% endblock %}

{% block javascript %}

    {{ parent() }}
    
    <script> 
    var $collectionHolder;

    // setup an "add a Representante" link
    var $addRepresentanteButton = $('<button type="button" class="btn btn-primary">AÃ±adir Representante</button>');
    var $newLinkLi = $('<li></li>').append($addRepresentanteButton);

    jQuery(document).ready(function() {
        
         // Get the ul that holds the collection of representantes
        $collectionHolder = $('ul.representantes');

        // add a delete link to all of the existing representante form li elements
        $collectionHolder.find('li').each(function() {
            addRepresentanteFormDeleteLink($(this));
        });
        
        // Get the ul that holds the collection of Representantes
        $collectionHolder = $('ul.representantes');

        // add the "add a Representante" anchor and li to the Representantes ul
        $collectionHolder.append($newLinkLi);

        // count the current form inputs we have (e.g. 2), use that as the new
        // index when inserting a new item (e.g. 2)
        $collectionHolder.data('index', $collectionHolder.find(':input').length);

        $addRepresentanteButton.on('click', function(e) {
            // add a new Representante form (see next code block)
            addRepresentanteForm($collectionHolder, $newLinkLi);
        });
    });
    
    function addRepresentanteForm($collectionHolder, $newLinkLi) {
        // Get the data-prototype explained earlier
        var prototype = $collectionHolder.data('prototype');

        // get the new index
        var index = $collectionHolder.data('index');

        var newForm = prototype;
        // You need this only if you didn't set 'label' => false in your Representantes field in TaskType
        // Replace '__name__label__' in the prototype's HTML to
        // instead be a number based on how many items we have
        // newForm = newForm.replace(/__name__label__/g, index);

        // Replace '__name__' in the prototype's HTML to
        // instead be a number based on how many items we have
        newForm = newForm.replace(/__name__/g, index);

        // increase the index with one for the next item
        $collectionHolder.data('index', index + 1);

        // Display the form in the page in an li, before the "Add a Representante" link li
        var $newFormLi = $('<li></li>').append(newForm);
        $newLinkLi.before($newFormLi);
        
        addRepresentanteFormDeleteLink($newFormLi);
    }
    
    function addRepresentanteFormDeleteLink($representanteFormLi) {
        var $removeFormButton = $('<button type="button" class="btn btn-primary">Eliminar Representante</button>');
        $representanteFormLi.append($removeFormButton);

        $removeFormButton.on('click', function(e) {
            // remove the li for the representante form
            $representanteFormLi.remove();
        });
    }
    </script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $('#appbundle_empresa_grupoActividad').change(function () {
            var grupoActividadSelector = $(this);
            
            // Request the neighborhoods of the selected city.
            $.ajax({
                url: "{{ path('empresa_list_actividades') }}",
                type: "GET",
                dataType: "JSON",
                data: {
                    grupoid: grupoActividadSelector.val()
                },
                success: function (actividades) {
                    var actividadSelect = $("#appbundle_empresa_idactividad");

                    // Remove current options
                    actividadSelect.html('');
                    
                    // Empty value ...
                    actividadSelect.append('<option value> Seleccione una actividad de ' + grupoActividadSelector.find("option:selected").text() + ' ...</option>');
                    
                    
                    $.each(actividades, function (key, actividad) {
                        actividadSelect.append('<option value="' + actividad.id + '">' + actividad.name + '</option>');
                    });
                },
                error: function (err) {
                    alert("An error ocurred while loading data ...");
                }
            });
        });
    </script>
   

{% endblock %}

